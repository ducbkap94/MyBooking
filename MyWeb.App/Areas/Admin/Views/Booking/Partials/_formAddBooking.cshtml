@model MyWeb.Business.Dtos.Asset.Response.AssetFormResponse

<!-- Modal -->

                <form id="assetForm" method="post">
                <div class="form-group">
                        @Html.AntiForgeryToken()
                        <label>Loại thiết bị</label>
                        <select id="ProductId" name="ProductId" class="form-control">
                            <option value="">--- Chọn loại thiết bị ----</option>
                            
                            @foreach (var prod in Model.Products)
                            {
                                <option value="@prod.Id" @(prod.Id == Model.Asset?.ProductId ? "selected" : "")>@prod.Name</option>
                            }
                            
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Serial Number</label>
                        <input type="text" id="SerialNumber" name="SerialNumber" value="@Model.Asset?.SerialNumber" class="form-control" />
                        <input type="hidden"  name="AssetId" id="AssetId" value="@Model.Asset?.AssetId" />
                    </div>
                    <div class="form-group">
                        <label>Giá Mua</label>
                        <input type="text" id="PurchasePrice" name="PurchasePrice" value="@Model.Asset?.PurchasePrice" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Ngày nhập kho</label>
                        <input type="date"   id="PurchaseDate" name="PurchaseDate" value='@Model.Asset?.PurchaseDate?.ToString("yyyy-MM-dd")' class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Thời gian bảo hành (tháng)</label>
                        <input type="number" id="WarrantyPeriod" name="WarrantyPeriod" value="@Model.Asset?.WarrantyPeriod" class="form-control" />
                    <div class="form-group">
                        <label>Nhà cung cấp</label>
                        <select id="SupplierId" name="SupplierId"  class="form-control">
                            <option value="">--- Chọn nhà cung cấp ----</option>
                            @foreach (var user in Model.Suppliers)
                            {
                                <option value="@user.Id" @(user.Id == Model.Asset?.SupplierId ? "selected" : "")>@user.FullName</option>
                            }
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Trạng thái</label>
                       <select id="Status" name="Status"  class="form-control">
                            <option value="1">Sẵn sàng</option>
                            <option value="2">Đang thuê</option>
                            <option value="3">Bảo trì</option>
                            
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Lưu</button>
                </form>

<script>


        const validation = new JustValidate('#assetForm');
        window.assetFormValidation = validation;

        validation
            .addField('#ProductId', [
                { rule: 'required', errorMessage: 'Vui lòng chọn thiết bị' },
            ])
            .addField('[name="SerialNumber"]',[
                { rule: 'required', errorMessage: 'Vui nhập Serial Number' },
            ])
            .addField('#SupplierId',[
                { rule: 'required', errorMessage: 'Vui lòng chọn nhà cung cấp' }
            ])
            .addField('#PurchasePrice',[
                { rule: 'required', errorMessage: 'Vui lòng nhập giá mua' },
                { rule: 'number', errorMessage: 'Giá mua phải là số' },
            ])
            .addField('#PurchaseDate',[
                { rule: 'required', errorMessage: 'Vui lòng nhập ngày nhập kho' },
            ])
            .addField('#WarrantyPeriod',[
                { rule: 'required', errorMessage: 'Vui lòng nhập thời gian bảo hành' },
            ])
            .onSuccess((event) => {
                event.preventDefault(); // chặn reload trang

                const form = document.querySelector('#assetForm');
                const formData = new FormData(form);

                fetch('/Admin/Asset/Save', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        alert(data.message);
                        return;
                    }
                    alert(data.message);
                    location.reload();
                })
                .catch(error => {
                    console.error('Lỗi:', error);
                    alert('Có lỗi xảy ra khi lưu dữ liệu.');
                });
            });

</script>